{"remainingRequest":"/home/l/CodeProjects/reset-gas/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/l/CodeProjects/reset-gas/src/components/CrowdFund.vue?vue&type=style&index=0&id=a40b7af4&scoped=true&lang=css&","dependencies":[{"path":"/home/l/CodeProjects/reset-gas/src/components/CrowdFund.vue","mtime":1614924884334},{"path":"/home/l/CodeProjects/reset-gas/node_modules/css-loader/dist/cjs.js","mtime":1614824573986},{"path":"/home/l/CodeProjects/reset-gas/node_modules/vue-loader/lib/loaders/stylePostLoader.js","mtime":1614824574443},{"path":"/home/l/CodeProjects/reset-gas/node_modules/postcss-loader/src/index.js","mtime":1601567296023},{"path":"/home/l/CodeProjects/reset-gas/node_modules/cache-loader/dist/cjs.js","mtime":1614824569995},{"path":"/home/l/CodeProjects/reset-gas/node_modules/vue-loader/lib/index.js","mtime":1614824574443}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKZGl2IHsKICBtYXJnaW46IDQwcHggMCAwOwp9CnVsIHsKICBsaXN0LXN0eWxlLXR5cGU6IG5vbmU7CiAgcGFkZGluZzogMDsKfQpsaSB7CiAgZGlzcGxheTogaW5saW5lLWJsb2NrOwogIG1hcmdpbjogMCAxMHB4Owp9CmEgewogIGNvbG9yOiAjNDJiOTgzOwp9Cg=="},{"version":3,"sources":["CrowdFund.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAsJA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"CrowdFund.vue","sourceRoot":"src/components","sourcesContent":["<template>\n<div class=\"content\">\n  <div>助记词: <input id=\"mnemonic\" v-model=\"mnemonic\" ></div>\n  <div><button @click=\"getAccount\">获取帐号信息</button></div>\n  <div>\n    <h3>address： {{account}}</h3>\n    <h3>NONCE： {{nonce}}</h3>\n    <h3>Balance: {{balance}} ether</h3>\n  </div>\n  <div>\n    <div>Nonce    : <input id=\"nonce\" v-model=\"nonce\" ></div>\n    <div>Gas Price: <input id=\"gasPrice\" v-model=\"gasPrice\" placeholder='GWEI'></div>\n    <div>Gas Limit: <input id=\"gas\" v-model=\"gasLimit\" placeholder='gas limit'></div>\n    <div>Pay      : <input id=\"pay\" v-model=\"payETH\" placeholder='(ether)'></div>\n    <div>To       : <input id=\"to\" v-model=\"to\" placeholder='address'></div>\n    <div>Data     : <input id=\"data\" v-model=\"sendData\" placeholder='0x00'></div>\n  </div>\n  <div><button @click=\"signButton\">signButton</button></div>\n  <div><button @click=\"sendButton\">sendButton</button></div>\n  <!-- <div><button @click=\"enableEthereum\">Enable Ethereum</button></div> -->\n</div>\n</template>\n\n<script>\nconst Web3 = require('web3')\nconst bip39 = require('bip39')\nconst Tx = require('ethereumjs-tx').Transaction;\nconst Common=require('ethereumjs-common').default\nconst {hdkey} = require('ethereumjs-wallet')\nconst util = require('ethereumjs-util')\n// const web3js = window.web3\n// let mnemonic = \"depart expose  labor robust  raven shaft toss curious nephew just end stairs\"\n\nlet web3 = new Web3(new Web3.providers.HttpProvider('https://ropsten.infura.io/v3/d3d7efacf489482785f091bbf019f2a9'));\n\n// let web3 = new Web3(web3js.currentProvider);\nexport default {\n  name: 'CrowdFund',\n  data() {\n    return {\n      mnemonic: null,\n      account: null,\n      balance: null,\n      nonce: null,\n      gasPrice: null,\n      gasLimit: null,\n      payETH: null,\n      to: '0x0000000000000000000000000000000000000000',\n      sendData: null,\n      serializedTx: null\n    }\n  },\n\n\n  methods: {\n    enableEthereum(){\n      console.log('click button');\n      window.ethereum.request({ method: 'eth_requestAccounts' });\n      this.getAccount();\n    },\n    async signButton(){\n\n      const customCommon = Common.forCustomChain(\n        'ropsten',\n        {\n          name: 'ropsten',\n          networkId: 3,\n          chainId: 3,\n        },\n        'petersburg',\n      )\n\n      console.log(customCommon)\n\n      let seed = await bip39.mnemonicToSeed(this.mnemonic)\n      \n      let hdWallet = await hdkey.fromMasterSeed(seed)\n      let key1 = await hdWallet.derivePath(\"m/44'/60'/0'/0/0\")\n      let privateKey1 = util.bufferToHex(key1._hdkey._privateKey)\n\n    \n      const privateKey = Buffer.from(\n        privateKey1.slice(2),\n        'hex',\n      )\n\n      console.log('account:', this.account);\n      console.log('nonce:', this.nonce);\n      console.log('to:', this.to);\n      const payETH = web3.utils.toHex(this.payETH*1e18);\n      console.log('value:', payETH);\n      const gasPrice = web3.utils.toHex(this.gasPrice*1e9);\n      console.log('gasPrice:', gasPrice);\n      const gasLimit = web3.utils.toHex(this.gasLimit);\n      console.log('gas:', gasLimit);\n      console.log('data:', this.sendData);\n\n      web3.eth.getTransactionCount(this.account).then(count=>{\n        console.log(count)\n          var rawTx = {\n                nonce: Number(this.nonce),\n                from: this.account,\n                to: this.to,\n                value: payETH,\n                gasPrice: gasPrice,\n                gas: gasLimit,\n                data: this.sendData\n            };\n\n          var tx=new Tx(rawTx,{common:customCommon})\n\n          tx.sign(privateKey)\n          this.serializedTx = tx.serialize();\n          console.log('0x' + this.serializedTx.toString('hex'))\n      })\n    },\n\n    async sendButton() {\n      web3.eth.sendSignedTransaction('0x' + this.serializedTx.toString('hex'))\n      .on('transactionHash', console.log)\n      .on('receipt', console.log)\n      .on('error', console.error);\n    },\n    async getAccount() {\n      // const accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });\n\n      let seed = await bip39.mnemonicToSeed(this.mnemonic)\n      \n      let hdWallet = await hdkey.fromMasterSeed(seed)\n      let key1 = await hdWallet.derivePath(\"m/44'/60'/0'/0/0\")\n\n      let address = await util.pubToAddress(key1._hdkey._publicKey, true)\n      this.account = '0x'+address.toString('hex');\n      web3.eth.getTransactionCount(this.account).then(count=>{\n        this.nonce = count\n        console.log(count)\n        })\n      web3.eth.getBalance(this.account).then(balance=>{\n        this.balance = (balance/1e18).toFixed(4)\n        console.log(balance)\n        })\n    },\n  }\n}\n</script>\n\n\n\n<!-- Add \"scoped\" attribute to limit CSS to this component only -->\n<style scoped>\ndiv {\n  margin: 40px 0 0;\n}\nul {\n  list-style-type: none;\n  padding: 0;\n}\nli {\n  display: inline-block;\n  margin: 0 10px;\n}\na {\n  color: #42b983;\n}\n</style>\n"]}]}